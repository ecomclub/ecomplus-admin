!function(){"use strict";var o=window.tabId,c=window.Tabs[o],h=c.commit,m=function(){return c.data},v=window.i18n,t=function(){var t=c.$form.find("#t"+o+"-items-container"),d=t.find("#t"+o+"-collections-items"),l=function(i,t){var r=i._id,e=function(t){return $("<a>",{href:"/#/resources/products/"+i._id,html:t})},n="",o=i.pictures;if(o[0]){var c=o[0].small||o[0].normal;c&&(n=e('<img src="'+c.url+'">')).addClass("cart-item-picture")}var a=$("<i>",{class:"py-10 pr-10 remove fa fa-trash"}).click(function(){for(var t=m(),i=0;i<t.products.length;i++)if(t.products[i]===r){t.products.splice(i,1),h(t,!0);break}s.remove()}),s=$("<tr>",{html:[$("<th>",{scope:"row",html:a}),$("<td>",{html:e(i.sku||"")}),$("<td>",{html:$("<input>",{id:"nameProduct",name:"items.name",type:"text"})}),$("<td>",{html:n})]});d.append(s),s.find("input").data("object-id",r),setupInputValues(s,i,"items.")},i=m().products;if(i&&i.length)for(var r=0;r<i.length;r++){var e="products/"+i[r]+".json";window.callApi(e,"GET",function(t,i){if(!t)var r=i;l(r)})}var f=[],p=t.find("#t"+o+"-new-collections-item");p.typeahead({hint:!0,highlight:!0,minLength:3},{name:"items",source:function(t,i,n){t=t.replace(/([()])/g,"\\$1").replace(/(^|\s)(AND|OR|\/)(\s|$)/g," ");var r="items.json?q="+encodeURIComponent("sku:"+t+" OR name:"+t);window.callSearchApi(r,"GET",function(t,i){if(!t&&i.hits){f=i.hits.hits;for(var r=0;r<f.length;r++){var e=f[r]._source;n([e.name+" ("+e.sku+")"])}}})}});var n=function(){var t=p.val().match(/^.*\s\((.*)\)$/);if(t){var i=t[1];if(i&&f.length){for(var r,e=0;e<f.length;e++){var n=f[e],o=n._source;if(o.sku===i){(r=o)._id=n._id;break}}if(r){var c,a=m(),s=a.products;if(Array.isArray(s)&&s.length&&void 0!==s)for(var d=0;d<a.products.length;d++){if(r._id===a.products[d]){c=null;break}c=r._id}else c=r._id;a.products||(a.products=[]);var u=a.products.length;null===c?app.toast(v({en_us:"Error! Already added this product in the collection!",pt_br:"Erro! Esse produto já foi inserido na coleção!"})):(a.products[u]=c,h(a),l(r))}}}};t.find("#t"+o+"-add-collections-item").click(n),p.click(function(){$(this).select()}).keydown(function(t){switch(t.which){case 13:t.preventDefault(),n()}})};c.$form?t():$(document).one("form-"+o,t)}();