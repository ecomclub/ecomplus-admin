/*!
 * Copyright 2018 E-Com Club
 */
"use strict";app.config({provide:[],googleApiKey:"AIzaSyDRBLFOTTh2NFM93HpUA4ZrA99yKnCAsto",googleAnalyticsId:"",smoothScroll:!1,saveState:!1}),app.ready(function(){var a,b={},c=function(){for(var a in b)b.hasOwnProperty(a)&&sessionStorage.setItem(a,b[a]);$(window).off("beforeunload"),location.reload()},d=localStorage.getItem("lang");d&&/^[a-z]{2}(_[a-z]{2})?$/.test(d)||(d="pt_br"),window.lang=d,a=$('#langs-menu [data-lang="'+d+'"]'),a.addClass("active"),$("#current-lang").find("img").attr("src",a.find("img").attr("src")).next().text(d.split("_")[0].toUpperCase()),$("#langs-menu > a").click(function(){localStorage.setItem("lang",$(this).data("lang")),c()});var e=function(a){return a.hasOwnProperty(d)?a[d]:a.en_us};window.i18n=e,$("head").append('<style type="text/css">.i18n > [data-lang="'+d+'"]{display: inline;}</style>'),$(".after-i18n").fadeIn();var f={home:e({en_us:"Home",pt_br:"Início"}),resources:e({en_us:"Resources",pt_br:"Recursos"}),channels:e({en_us:"Sales channels",pt_br:"Canais de venda"}),go_to_store:e({en_us:"Go to store",pt_br:"Ir à loja"}),themes:e({en_us:"Themes",pt_br:"Temas"}),settings:e({en_us:"Settings",pt_br:"Configurações"}),unknown_error:e({en_us:"Unknown error, please try again",pt_br:"Erro desconhecido, por favor tente novamente"})},g=function(){$("div.toast.reveal").removeClass("reveal")},h=function(a){var b;"object"==typeof a&&null!==a&&(a.hasOwnProperty("user_message")?b=a.user_message[d]:a.hasOwnProperty("message")&&(b=a.message)),void 0!==b?console.log("API Error Code: "+a.error_code):b=f.unknown_error,app.toast(b,{duration:7e3})};if("boolean"==typeof login&&!0===login){!function(a){var b,c=function(){b=["../assets/img/bg/coffee.jpg","../assets/img/bg/notebook.jpg","../assets/img/bg/numbers.jpg","../assets/img/bg/pens.jpg","../assets/img/bg/table.jpg","../assets/img/bg/writer.jpg"]};c();var d=function(){var d=new Image;d.onload=function(){var b=this;$(a).fadeOut(1e3,function(){$(this).css("background-image","url("+b.src+")").fadeIn()})};var e=Math.floor(Math.random()*(b.length-1));d.src=b[e],b.splice(e,1),0===b.length&&c()};d(),setInterval(d,9e3)}("#full-bg");var i=localStorage.getItem("username");i&&$("#username").val(i),$("#username, #password").change(function(){""!==$(this).val()&&$(this).parent().addClass("do-float")}).trigger("change"),$("#login-form").submit(function(){if(!$(this).hasClass("ajax")){g();var a=$("#username").val(),b=md5($("#password").val());$("#remember").is(":checked")?localStorage.setItem("username",a):localStorage.removeItem("username");var c=$(this);c.addClass("ajax");var d=function(a,b,d){403!==a.status&&console.error(d),h(a.responseJSON),c.removeClass("ajax")};$.ajax({url:"https://api.e-com.plus/v1/_login.json?username",method:"POST",dataType:"json",headers:{"X-Store-ID":1},data:JSON.stringify({username:a,pass_md5_hash:b})}).done(function(b){console.log("Logged");var c=b.store_id;localStorage.setItem("store_id",c),$.ajax({url:"https://api.e-com.plus/v1/_authenticate.json",method:"POST",dataType:"json",headers:{"X-Store-ID":c},data:JSON.stringify({_id:b._id,api_key:b.api_key})}).done(function(b){sessionStorage.setItem("my_id",b.my_id),sessionStorage.setItem("access_token",b.access_token),sessionStorage.setItem("expires",b.expires),sessionStorage.setItem("username",a);var c=sessionStorage.getItem("go_to");c?sessionStorage.removeItem("go_to"):c="/",window.location=c}).fail(d)}).fail(d)}}),$(document).keypress(function(a){13===a.which&&$("#login-form").submit()})}else{var j=localStorage.getItem("store_id");if(b.my_id=b.access_token=null,j>0&&(b.my_id=sessionStorage.getItem("my_id"),b.access_token=sessionStorage.getItem("access_token")),!b.my_id||!b.access_token)return sessionStorage.setItem("go_to",window.location.href),void(window.location="/pages/login.html");console.log("Hello #"+b.my_id),sessionStorage.removeItem("my_id"),sessionStorage.removeItem("access_token");var k={};window.callApi=function(a,c,d,f,i){g();var l,m="https://api.e-com.plus/v1/";if(void 0===i){l=m+a;var n=function(b){var e=Date.now();k[e]={endpoint:a,method:c,callback:d,bodyObject:f,confirmed:!1};var g=c+" "+l;f&&(g+="\n"+JSON.stringify(f,null,2));var h=$("#modal-confirm-request");h.find("#confirm-api-request").data("request-id",e),h.find(".modal-body > p").text(b).next("pre").children("code").text(g),h.modal("show")};switch(c){case"GET":case"POST":case"PATCH":case"PUT":break;case"DELETE":return void n(e({en_us:"You are going to delete a resource permanently, are you sure?",pt_br:"Você vai excluir um recurso permanentemente, tem certeza?"}));default:return void app.toast(e({en_us:"Invalid request method",pt_br:"Método de requisição inválido"}))}if("string"!=typeof a||""===a)return void app.toast(e({en_us:"Invalid request endpoint",pt_br:"O endpoint da requisição é inválido"}));if(/^\$update\.json/.test(a))return void n(e({en_us:"You are going to do a bulk update, are you sure?",pt_br:"Você vai fazer uma atualização em massa, tem certeza?"}))}else{if(!k.hasOwnProperty(i)||!0!==k[i].confirmed)return app.toast(e({en_us:"You should not do that",pt_br:"Você não deveria fazer isto"})),!1;a=k[i].endpoint,c=k[i].method,d=k[i].callback,f=k[i].bodyObject,l=m+a}var o={url:l,method:c,dataType:"json",headers:{"X-Store-ID":j,"X-My-ID":b.my_id,"X-Access-Token":b.access_token}};f&&(o.data=JSON.stringify(f));var p=$.ajax(o);p.done(function(a){"function"==typeof d?d(null,a):console.log(a)}),p.fail(function(a,b,c){var e=a.responseJSON;"function"==typeof d&&d(c,e),h(e),a.status>=500&&(console.log("API request with internal error response:"),console.log(a))})},$("#confirm-api-request").click(function(){var a=$(this).data("request-id");a&&k.hasOwnProperty(a)&&(k[a].confirmed=!0,window.callApi(null,null,null,null,a))}),$(window).on("beforeunload",function(a){var b="Are you sure you want to leave?";return a.returnValue=b,b});var l,m={},n=null,o=!1,p=!1,q=function(a,b){if(!0!==o){var c=Date.now();n=c,m[n]={routesHistory:[]},$("#route-content").append('<div id="app-tab-'+c+'"></div>');var d=$("#new-nav-item").clone().attr("id","app-nav-"+c);d.prependTo("#app-nav-tabs").toggle("slide"),d.children("a").attr("data-tab",c).click(r).click(),d.children(".close-tab").click(function(){s(c)}),b&&("#/new"===window.location.hash?v():window.location="/#/new")}"function"==typeof a&&a()},r=function(){if(!0!==o){n=parseInt($(this).attr("data-tab"),10);var a=function(){var a=$("#app-tab-"+n),b=a.children();b.hide(),a.addClass("app-current-tab"),b.fadeIn(100);var c=m[n].hash;void 0!==c&&(""===c&&(c="#/"),c!==window.location.hash&&(p=!0,window.location="/"+c))},b=$("#route-content > .app-current-tab");b.length?($("#app-nav-tabs .active").removeClass("active"),b.children().fadeOut(200,function(){b.removeClass("app-current-tab"),a()})):a(),$(this).addClass("active")}};$("#new-tab").click(function(){q(null,!0)});var s=function(a){if(!0!==o){if(delete m[a],a===n){var b=Object.keys(m);0===b.length?q(null,!0):$("#app-nav-"+b[b.length-1]+" > a").click()}$("#app-tab-"+a).remove(),$("#app-nav-"+a).toggle("slide",function(){$(this).remove()})}};$("#close-current-tab").click(function(){s(n)});var t=function(a,b){if(!b){if(!0===o)return;console.log("Go to route => "+a),null!==n&&m[n].routesHistory.push(a)}o=!0,window.routeParams=[];for(var c=a.split("/"),d="routes/"+c[0]+".html",e=1;e<c.length;e++)""!==c[e]&&window.routeParams.push(c[e]);$("#router > .loading").show(),$.ajax({url:d,dataType:"html",timeout:1e4}).done(function(a){var c=$("#app-tab-"+n);window.tabId=n,window.elTab=c,b||(l=setTimeout(function(){t("408",!0)},1e4)),c.html(a)}).fail(function(a,b,c){if(404===a.status)window.e404();else{var d;switch(b){case"abort":d="400";break;case"timeout":d="504";break;default:console.error(c),d="500"}t(d,!0)}})};window.routeReady=function(a){o=!1,clearTimeout(l),l=null,void 0!==a&&$("#app-nav-"+window.tabId+" > a").text(a),$("#router > .loading").fadeOut(),window.elTab.children().fadeIn()},window.e404=function(){t("404",!0)};var u=function(a){if("#/new"!==a)for(var b in m)if(m.hasOwnProperty(b)&&m[b].hash===a)return $("#app-nav-"+b+" > a").click(),!1;return!0},v=function(){var a=window.location.hash,b=a.slice(2);if(""===b)return void(window.location="/#/home");if(p)p=!1;else{if(!u(a))return;if(!0!==o)t(b);else if(null!==n){var c=m[n].routesHistory;if(c.length>0)return p=!0,void(window.location="/#/"+c[c.length-1])}}null!==n&&(m[n].hash=a)};$(window).on("hashchange",v),$("#previous-route").click(function(){if(null!==n){var a=m[n].routesHistory;if(a.length-2>=0){a.pop();var b=a.pop();window.location="/#/"+b}}}),window.apiResources={products:{label:{en_us:"Products",pt_br:"Produtos"},icon:"tags"},orders:{label:{en_us:"Orders",pt_br:"Pedidos"},icon:"rocket"},brands:{label:{en_us:"Brands",pt_br:"Marcas"},icon:"trademark"},categories:{label:{en_us:"Categories",pt_br:"Categorias"},icon:"bookmark"},collections:{label:{en_us:"Collections",pt_br:"Coleções"},icon:"th-large"},grids:{label:{en_us:"Grids",pt_br:"Grades"},icon:"filter"},customers:{label:{en_us:"Customers",pt_br:"Clentes"},icon:"users"},carts:{label:{en_us:"Carts",pt_br:"Carrinhos"},icon:"shopping-cart"},authentications:{label:{en_us:"Users",pt_br:"Usuários"},icon:"id-card"}};!function(){var a="";for(var b in window.apiResources)if(window.apiResources.hasOwnProperty(b)){var c=window.apiResources[b];a+='<li class="menu-item"><a class="menu-link" href="/#/resources/'+b+'"><span class="icon fa fa-'+c.icon+'"></span><span class="title">'+e(c.label)+"</span></a></li>"}var d='<li class="menu-item"><a class="menu-link" href="/#/"><span class="icon fa fa-home"></span><span class="title">'+f.home+'</span></a></li><li class="menu-item"><a class="menu-link" href="javascript:;"><span class="icon fa fa-database"></span><span class="title">'+f.resources+'</span><span class="arrow"></span></a><ul class="menu-submenu">'+a+'</ul></li><li class="menu-item"><a class="menu-link" href="/#/apps"><span class="icon fa fa-puzzle-piece"></span><span class="title">Apps</span></a></li><li class="menu-item"><a class="menu-link" href="/#/settings"><span class="icon fa fa-cogs"></span><span class="title">'+f.settings+'</span></a></li><li class="menu-category">'+f.channels+"</li>";$("#sidebar").append(d),$(".sidebar-toggler").is(":visible")&&sidebar.unfold()}();!function(){var a=$("#sidebar");a.find(".li-channel").remove();for(var b=0;b<1;b++){var c="/#/channels/channel_id",d='<li class="menu-item li-channel"><a class="menu-link" href="javascript:;"><span class="icon fa fa-shopping-bag"></span><span class="title">Channel name</span><span class="arrow"></span></a><ul class="menu-submenu"><li class="menu-item"><a class="menu-link" href="https://google.com" target="_blank"><span class="icon fa fa-eye"></span><span class="title">'+f.go_to_store+'</span></a></li><li class="menu-item"><a class="menu-link" href="'+c+'/themes"><span class="icon fa fa-paint-brush"></span><span class="title">'+f.themes+'</span></a></li><li class="menu-item"><a class="menu-link" href="'+c+'/settings"><span class="icon fa fa-wrench"></span><span class="title">'+f.settings+"</span></a></li></ul></li>";a.append(d)}}(),$("#dashboard").fadeIn(),q(function(){v()}),$(".qv-close").click(function(){quickview.close($(this).closest(".quickview"))}),$(".logout").click(function(){$("#modal-logout").modal("show")}),$("#logout").click(function(){$(window).off("beforeunload"),window.location="/"});var w=!1,x=function(a){u(a)&&q(function(){window.location.hash===a?v():window.location="/"+a})};$(document).mousedown(function(a){return(a.ctrlKey||2===a.which)&&(w=!0),!0}),$(document).click(function(a){if(!0===w){w=!1;var b,c;for(b=a.target;b&&void 0===c;)switch(b.nodeName){case"A":c=b;break;case"DIV":case"P":case"BUTTON":case"BODY":b=!1;break;default:b=b.parentElement}if(void 0===c||"string"!=typeof c.href)return!0;switch(c.href){case"javascript:;":case"#":return a.preventDefault(),!0}var d=c.href.split(window.location.origin+"/#");if(2===d.length){a.preventDefault();var e="#"+d[1];"#"!==e&&x(e)}}});var y={},z={},A=function(a){switch(Object.keys(y).length){case 1:switch(a.keyCode){case 37:$("#app-nav-"+n).prev().children("a").click();break;case 39:var b=$("#app-nav-"+n).next();"new-nav-item"!==b.attr("id")&&b.children("a").click();break;case 84:q(null,!0);break;case 87:s(n);break;case 83:a.preventDefault(),$("#app-search").focus();break;case 81:$(".topbar img.avatar").click();break;case 77:dock.toggleMinimize("#dock-chat")}break;case 2:var c,d=function(){switch(a.keyCode){case 80:return"/#/resources/products";case 79:return"/#/resources/orders";case 73:return"/#/resources/categories";case 85:return"/#/resources/customers";case 89:return"/#/resources/brands";case 84:return"/#/resources/carts";case 82:return"/#/resources/grids";case 69:return"/#/resources/collections";case 87:return"/#/resources/authentications"}};if(0===y[71])switch(a.keyCode){case 72:window.location="/#/";break;case 83:window.location="/#/settings";break;case 65:window.location="/#/apps";break;default:c=d(),c&&(window.location=c)}else 0===y[65]&&(c=d())&&(window.location=c+"/new");break;case 3:0===y[66]&&1===y[89]&&2===y[69]&&$("#logout").click()}};$(document).keydown(function(a){return"BODY"!==a.target.nodeName?27!==a.keyCode||void $(a.target).blur():!0===z[a.keyCode]||void(void 0!==y[a.keyCode]?(A(a),z[a.keyCode]=!0):y[a.keyCode]=Object.keys(y).length)}).keyup(function(a){if("BODY"!==a.target.nodeName)return!0;!0!==z[a.keyCode]?void 0!==y[a.keyCode]&&A(a):delete z[a.keyCode],delete y[a.keyCode]});var B=function(a,c){var d,e,f,g=b.my_id,h=b.access_token;window.callApi("authentications/me.json","GET",function(b,i){b&&console.log(b),d=i.name,e=i.email,f=i._id,C(a,c,d,e,f,h,g)})},C=function(a,b,c,d,e,f,g){var h=!1;window.Mony.init(a,b,null,c,null,d,e,null,f,g,function(a){$("#mony").append('<div class="media media-chat"><div class="media-body"><p>'+a+'</p><p class="meta"><time datetime="2017">23:58</time></p></div></div>'),!1===h&&($("#mony > .media.media-chat").remove(),h=!0)}),$("input.publisher-input").keypress(function(a){13===a.which&&($("#mony").append('<div class=" media media-chat media-chat-reverse"><div class="media-body"><p>'+$("input.publisher-input").val()+'</p><p class="meta"><time datetime="2017">23:58</time></p></div></div>'),window.Mony.sendMessage($("input.publisher-input").val()),$("input.publisher-input").val(""))})};!function(){var a,b;$("#mony > .media.media-chat").remove(),window.callApi("stores/me.json","GET",function(c,d){c&&console.log(c),a=d.store_id,b=d.name,B(a,b)})}()}});